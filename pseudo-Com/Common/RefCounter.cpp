//////////////////////////////////////////////////////////////////////////
// Module: RefCounter.cpp is managing object lifetimes through
// reference counting
//////////////////////////////////////////////////////////////////////////

#include "pch.h"
#include "framework.h"

//////////////////////////////////////////////////////////////////////////

GCN_NAMESPACE_BEGIN

//////////////////////////////////////////////////////////////////////////


CRefCounter::~CRefCounter()
{
}

CRefCounter::CRefCounter()
    : m_nRef(0)
{

}

long CRefCounter::AddRef()
{
    return (1 + (long)sync::AtomicInc32(m_nRef));
}

long CRefCounter::Release()
{
    long lRes = (long)sync::AtomicDec32(m_nRef) - 1;

    if (0 == lRes)
    {
        Close();

        SelfDestroy();
    }

    return lRes;
}

long CRefCounter::get()
{
    return sync::AtomicRead32(m_nRef);
}

//////////////////////////////////////////////////////////////////////////

GCN_NAMESPACE_END

//////////////////////////////////////////////////////////////////////////
